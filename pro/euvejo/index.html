<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidzPortal - Spy Worksheet Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-grad-1: #1a1a1a;
            --bg-grad-2: #2c3e50;
            --main-color: #2c3e50;
            --accent-color: #ff9f43;
            --text-color: #333;
            --a4-width: 210mm;
            --a4-height: 297mm;
        }

        * { box-sizing: border-box; -webkit-print-color-adjust: exact; }
        body { margin: 0; font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, var(--bg-grad-1), var(--bg-grad-2)); display: flex; justify-content: center; min-height: 100vh; }

        /* Sidebar */
        .settings-panel { width: 360px; background: rgba(0, 0, 0, 0.95); padding: 20px; height: 100vh; position: sticky; top: 0; overflow-y: auto; color: white; border-right: 1px solid rgba(255,255,255,0.1); scrollbar-width: thin; }
        .panel-header { font-family: 'Fredoka', sans-serif; font-size: 1.5rem; color: var(--accent-color); margin-bottom: 20px; text-align: center; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        
        .control-group { margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 700; color: var(--accent-color); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }
        
        select, input[type="text"], input[type="number"] { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #444; background: #222; color: white; margin-bottom: 5px; font-family: 'Nunito'; font-size: 0.9rem; }
        select:focus, input:focus { border-color: var(--accent-color); outline: none; background: #333; }
        
        /* Color Pickers */
        .color-row { display: flex; gap: 10px; align-items: center; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 40px; height: 40px; padding: 0; background: none; cursor: pointer; border-radius: 50%; overflow: hidden; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 2px solid #fff; border-radius: 50%; }

        /* Sliders */
        .slider-container { display: flex; align-items: center; gap: 10px; }
        input[type=range] { flex-grow: 1; accent-color: var(--accent-color); cursor: pointer; }
        .val-display { width: 30px; text-align: center; font-weight: bold; font-size: 0.9rem; }

        /* Checkbox */
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 5px; }
        .checkbox-wrapper input { width: auto; transform: scale(1.3); accent-color: var(--accent-color); }

        .btn-gen { width: 100%; padding: 12px; background: var(--accent-color); color: #000; font-weight: 900; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; font-family: 'Fredoka'; text-transform: uppercase; transition: transform 0.1s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .btn-gen:active { transform: scale(0.98); }
        .btn-print { width: 100%; padding: 12px; background: transparent; border: 2px solid var(--accent-color); border-radius: 8px; color: var(--accent-color); font-weight: 900; cursor: pointer; margin-top: 10px; }
        .btn-print:hover { background: rgba(255,255,255,0.1); }

        /* Worksheet */
        .worksheet-wrapper { background: white; width: var(--a4-width); height: var(--a4-height); padding: 15mm; position: relative; margin: 20px; box-shadow: 0 0 40px rgba(0,0,0,0.6); display: flex; flex-direction: column; overflow: hidden; }

        .ws-header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 3px solid var(--main-color); padding-bottom: 10px; margin-bottom: 10px; height: 12%; }
        .ws-title { font-family: 'Fredoka'; font-size: 2.5rem; color: var(--main-color); text-transform: uppercase; line-height: 1; margin-bottom: 5px; }
        .ws-instr { font-size: 0.95rem; color: #555; max-width: 400px; line-height: 1.3; }
        .ws-info { text-align: right; font-size: 0.9rem; color: #444; font-weight: bold; line-height: 1.8; }
        .ws-info span { color: var(--main-color); }

        /* Game Area */
        .game-area { 
            position: relative; 
            width: 100%; 
            height: 70%; 
            border: 2px solid var(--main-color); 
            border-radius: 12px; 
            overflow: hidden; 
            background: #fafafa;
        }

        .scatter-item {
            position: absolute;
            font-size: 1.5rem;
            line-height: 1;
            user-select: none;
            cursor: default;
        }

        /* Quest Footer */
        .quest-area { 
            height: 18%; 
            margin-top: 15px; 
            border-top: 2px dashed #ccc; 
            padding-top: 10px; 
        }
        .quest-title { font-family: 'Fredoka'; font-size: 1.3rem; margin-bottom: 10px; color: var(--main-color); text-transform: uppercase; }
        .quest-grid { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            justify-content: center;
        }
        .quest-item { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            border: 1px solid #ddd; 
            padding: 6px 12px; 
            border-radius: 30px; 
            background: #fff;
            min-width: 90px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }
        .q-icon { font-size: 1.6rem; }
        .q-box { 
            width: 30px; height: 30px; border: 2px solid var(--main-color); border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-family: 'Fredoka'; font-size: 1.1rem; color: var(--main-color);
        }

        @media print {
            body { background: white; display: block; }
            .settings-panel { display: none; }
            .worksheet-wrapper { margin: 0; box-shadow: none; width: 100%; height: 100vh; page-break-after: always; padding: 10mm; }
            .game-area { border-color: #000; }
            .ws-header { border-bottom-color: #000; }
        }
    </style>
</head>
<body>

    <div class="settings-panel">
        <div class="panel-header">ğŸ” SPY CREATOR</div>

        <div class="control-group">
            <label>1. Language </label>
            <select id="langSelect" onchange="updateLanguage()">
                <option value="id" selected>ğŸ‡®ğŸ‡© Indonesia</option>
                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="ms">ğŸ‡²ğŸ‡¾ Melayu</option>
                <option value="ar">ğŸ‡¸ğŸ‡¦ Arabic (Text)</option>
                <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                <option value="nl">ğŸ‡³ğŸ‡± Nederlands</option>
                <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
                <option value="pl">ğŸ‡µğŸ‡± Polski</option>
                <option value="ru">ğŸ‡·ğŸ‡º Russian</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ Japanese</option>
                <option value="ko">ğŸ‡°ğŸ‡· Korean</option>
            </select>
        </div>

        <div class="control-group">
            <label>2. Customize Text (Edit Anything)</label>
            <input type="text" id="inpTitle" value="I SPY: ANIMALS" oninput="renderText()" placeholder="Main Title">
            <input type="text" id="inpInstr" value="Count the items and write the number in the box!" oninput="renderText()" placeholder="Instructions">
            <div style="display:flex; gap:5px;">
                <input type="text" id="inpName" value="Name" oninput="renderText()" placeholder="Name Label">
                <input type="text" id="inpDate" value="Date" oninput="renderText()" placeholder="Date Label">
            </div>
            <input type="text" id="inpQuestTitle" value="FIND & COUNT:" oninput="renderText()" placeholder="Bottom Section Title">
        </div>

        <div class="control-group">
            <label>3. Theme & Colors</label>
            <select id="themeSelect">
                <option value="animals">ğŸ¦ Animals (Safe)</option>
                <option value="transport">ğŸš— Transport</option>
                <option value="nature">ğŸŒ² Nature</option>
                <option value="fruit">ğŸ Fruit & Veg</option>
                <option value="ocean">ğŸ  Ocean</option>
                <option value="shapes">ğŸ”· Shapes</option>
            </select>
            <div class="color-row" style="margin-top:10px;">
                <div style="text-align:center;">
                    <input type="color" id="colMain" value="#2c3e50" oninput="updateColors()">
                    <div style="font-size:0.6rem; margin-top:2px;">MAIN</div>
                </div>
                <div style="text-align:center;">
                    <input type="color" id="colAcc" value="#ff9f43" oninput="updateColors()">
                    <div style="font-size:0.6rem; margin-top:2px;">ACCENT</div>
                </div>
            </div>
        </div>

        <div class="control-group">
            <label>4. Difficulty Settings</label>
            
            <label style="font-weight:400; margin-top:10px;">Total Items (Density)</label>
            <div class="slider-container">
                <input type="range" id="density" min="20" max="150" value="50" oninput="document.getElementById('densVal').innerText=this.value">
                <span id="densVal" class="val-display">50</span>
            </div>

            <label style="font-weight:400; margin-top:10px;">Items to Find (Quest)</label>
            <div class="slider-container">
                <input type="range" id="questCount" min="3" max="8" value="5" oninput="document.getElementById('questVal').innerText=this.value">
                <span id="questVal" class="val-display">5</span>
            </div>
            
            <label class="checkbox-wrapper" style="margin-top:15px;">
                <input type="checkbox" id="sizeVar" checked>
                <span>Random Sizes</span>
            </label>
            <label class="checkbox-wrapper">
                <input type="checkbox" id="rotVar" checked>
                <span>Random Rotation</span>
            </label>
            
            <hr style="border:0; border-top:1px dashed #555; margin:15px 0;">
            
            <label class="checkbox-wrapper">
                <input type="checkbox" id="showSolution" onchange="generate(false)"> <span style="color:var(--accent-color); font-weight:bold;">Show Answer Key</span>
            </label>
        </div>

        <button class="btn-gen" onclick="generate(true)">ğŸ² GENERATE NEW PUZZLE</button>
        <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ PRINT PDF</button>
		<button class="btn-print" onclick="saveAsImage()">ğŸ’¾ SAVE AS IMAGE</button>

    </div>

    <div class="worksheet-wrapper">
        <div class="ws-header">
            <div>
                <div class="ws-title" id="outTitle">I SPY: ANIMALS</div>
                <div class="ws-instr" id="outInstr">Count the items and write the number in the box!</div>
            </div>
            <div class="ws-info">
                <span id="outName">Name</span>: _________________<br>
                <span id="outDate">Date</span>: _________________
            </div>
        </div>

        <div class="game-area" id="gameArea">
            </div>

        <div class="quest-area">
            <div class="quest-title" id="outQuestTitle">FIND & COUNT:</div>
            <div class="quest-grid" id="questGrid">
                </div>
        </div>
    </div>

    <script>
        // SAFE & HALAL THEMES (No pig, dog, religious symbols)
        // REPLACED WITH WEB-SAFE EMOJIS ONLY (No newer Unicode 13/14 emojis)
        const themes = {
            animals: ['ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¯','ğŸ¦','ğŸ®','ğŸ¸','ğŸµ','ğŸ”','ğŸ§','ğŸ¦','ğŸ¤','ğŸ¦†','ğŸ¦…','ğŸ¦‰','ğŸ¦‡','ğŸ´','ğŸ¢','ğŸ¦‹','ğŸ¦–','ğŸ¦“'],
            transport: ['ğŸš—','ğŸš•','ğŸš™','ğŸšŒ','ğŸï¸','ğŸš“','ğŸš‘','ğŸš’','ğŸšœ','ğŸš²','ğŸš‚','âœˆï¸','ğŸš€','ğŸš','â›µ','âš“','ğŸš¦','ğŸ›¶'],
            fruit: ['ğŸ','ğŸ','ğŸ','ğŸŠ','ğŸ‹','ğŸŒ','ğŸ‰','ğŸ‡','ğŸ“','ğŸ’','ğŸ‘','ğŸ','ğŸ¥¥','ğŸ¥','ğŸ…','ğŸ†','ğŸ¥‘','ğŸŒ½','ğŸ¥•'],
            ocean: ['ğŸŸ','ğŸ ','ğŸ¡','ğŸ™','ğŸš','ğŸ¦€','ğŸ¬','ğŸ³','ğŸ‹','ğŸ¦ˆ'],
            nature: ['ğŸŒ²','ğŸŒ³','ğŸŒ´','ğŸŒµ','ğŸŒ·','ğŸŒ¸','ğŸŒ¹','ğŸŒº','ğŸŒ»','ğŸŒ¼','ğŸ','ğŸ‚','ğŸƒ','ğŸ„','â­','â˜€ï¸'],
            shapes: ['ğŸ”´','ğŸŸ ','ğŸŸ¡','ğŸŸ¢','ğŸ”µ','ğŸŸ£','âš«','âšª','ğŸŸ¥','ğŸŸ§','ğŸŸ¨','ğŸŸ©','ğŸŸ¦','ğŸŸª','â¬›','â¬œ','ğŸ”º','ğŸ”·','â­']
        };

        const translations = {
            id: { t: "I SPY: HEWAN", i: "Hitung gambarnya dan tulis angkanya di dalam kotak!", n: "Nama", d: "Tanggal", q: "TEMUKAN & HITUNG:" },
            en: { t: "I SPY: ANIMALS", i: "Count the items and write the number in the box!", n: "Name", d: "Date", q: "FIND & COUNT:" },
            ms: { t: "SAYA INTIP: HAIWAN", i: "Kira item dan tulis nombor di dalam kotak!", n: "Nama", d: "Tarikh", q: "CARI & KIRA:" },
            ar: { t: "Ø£Ù†Ø§ Ø£ØªØ¬Ø³Ø³: Ø­ÙŠÙˆØ§Ù†Ø§Øª", i: "Ø¹Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆØ§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹!", n: "Ø§Ù„Ø§Ø³Ù…", d: "Ø§Ù„ØªØ§Ø±ÙŠØ®", q: "Ø§Ø¨Ø­Ø« ÙˆØ§Ø­Ø³Ø¨:" },
            de: { t: "ICH SEHE WAS: TIERE", i: "ZÃ¤hle die GegenstÃ¤nde und schreibe die Zahl in die Box!", n: "Name", d: "Datum", q: "FINDE & ZÃ„HLE:" },
            fr: { t: "J'ESPIONNE: ANIMAUX", i: "Comptez les objets et Ã©crivez le nombre dans la case!", n: "Nom", d: "Date", q: "TROUVER & COMPTER:" },
            es: { t: "VEO VEO: ANIMALES", i: "Â¡Cuenta los objetos y escribe el nÃºmero en la caja!", n: "Nombre", d: "Fecha", q: "ENCUENTRA Y CUENTA:" },
            it: { t: "VEDO VEDO: ANIMALI", i: "Conta gli oggetti e scrivi il numero nella casella!", n: "Nome", d: "Data", q: "TROVA E CONTA:" },
            pt: { t: "EU VEJO: ANIMAIS", i: "Conte os itens e escreva o nÃºmero na caixa!", n: "Nome", d: "Data", q: "ENCONTRE E CONTE:" },
            nl: { t: "IK ZIE: DIEREN", i: "Tel de items en schrijf het nummer in het vak!", n: "Naam", d: "Datum", q: "ZOEK & TEL:" },
            tr: { t: "I SPY: HAYVANLAR", i: "Ã–ÄŸeleri sayÄ±n ve kutuya sayÄ±yÄ± yazÄ±n!", n: "Ä°sim", d: "Tarih", q: "BUL & SAY:" },
            pl: { t: "SZPIEG: ZWIERZÄ˜TA", i: "Policz przedmioty i wpisz liczbÄ™ w pole!", n: "ImiÄ™", d: "Data", q: "ZNJDÅ¹ I POLICZ:" },
            ru: { t: "Ğ¯ Ğ¨ĞŸĞ˜ĞĞ: Ğ–Ğ˜Ğ’ĞĞ¢ĞĞ«Ğ•", i: "ĞŸĞ¾ÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹ Ğ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ² Ñ€Ğ°Ğ¼ĞºĞµ!", n: "Ğ˜Ğ¼Ñ", d: "Ğ”Ğ°Ñ‚Ğ°", q: "ĞĞĞ™Ğ”Ğ˜ Ğ˜ ĞŸĞĞ¡Ğ§Ğ˜Ğ¢ĞĞ™:" },
            ja: { t: "ã‚¢ã‚¤ã‚¹ãƒ‘ã‚¤ï¼šå‹•ç‰©", i: "ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ•°ãˆã¦ã€ç®±ã«æ•°å­—ã‚’æ›¸ã„ã¦ãã ã•ã„ï¼", n: "åå‰", d: "æ—¥ä»˜", q: "è¦‹ã¤ã‘ã¦æ•°ãˆã‚‹:" },
            ko: { t: "ë‚˜ëŠ” ê°„ì²©: ë™ë¬¼", i: "í•­ëª©ì„ ì„¸ê³  ìƒìì— ìˆ«ìë¥¼ ì“°ì‹­ì‹œì˜¤!", n: "ì´ë¦„", d: "ë‚ ì§œ", q: "ì°¾ê¸° ë° ê³„ì‚°:" }
        };

        // State to hold current game data so we can redraw answer key without regenerating positions
        let gameState = {
            icons: [],
            counts: {},
            targetIcons: []
        };

        function updateColors() {
            const main = document.getElementById('colMain').value;
            const acc = document.getElementById('colAcc').value;
            const root = document.documentElement;
            
            root.style.setProperty('--main-color', main);
            root.style.setProperty('--accent-color', acc);
        }

        function updateLanguage() {
            const lang = document.getElementById('langSelect').value;
            const data = translations[lang];
            
            document.getElementById('inpTitle').value = data.t;
            document.getElementById('inpInstr').value = data.i;
            document.getElementById('inpName').value = data.n;
            document.getElementById('inpDate').value = data.d;
            document.getElementById('inpQuestTitle').value = data.q;
            
            renderText();
        }

        function renderText() {
            document.getElementById('outTitle').innerText = document.getElementById('inpTitle').value;
            document.getElementById('outInstr').innerText = document.getElementById('inpInstr').value;
            document.getElementById('outName').innerText = document.getElementById('inpName').value;
            document.getElementById('outDate').innerText = document.getElementById('inpDate').value;
            document.getElementById('outQuestTitle').innerText = document.getElementById('inpQuestTitle').value;
        }

        function generate(isNew = true) {
            const themeKey = document.getElementById('themeSelect').value;
            const totalItems = parseInt(document.getElementById('density').value);
            const questCount = parseInt(document.getElementById('questCount').value);
            const sizeVar = document.getElementById('sizeVar').checked;
            const rotVar = document.getElementById('rotVar').checked;
            const showSolution = document.getElementById('showSolution').checked;

            const gameArea = document.getElementById('gameArea');
            const questGrid = document.getElementById('questGrid');

            // IF NEW GAME REQUESTED
            if (isNew) {
                const icons = themes[themeKey];
                gameArea.innerHTML = '';
                
                const shuffledIcons = [...icons].sort(() => 0.5 - Math.random());
                const targetIcons = shuffledIcons.slice(0, questCount);
                
                let pool = [];
                let counts = {};

                // Init counts for targets
                targetIcons.forEach(icon => {
                    pool.push(icon); // Force include
                    counts[icon] = 0; 
                });

                // Fill rest
                for(let i = pool.length; i < totalItems; i++) {
                    const randomIcon = icons[Math.floor(Math.random() * icons.length)];
                    pool.push(randomIcon);
                }

                // Shuffle placement
                pool.sort(() => 0.5 - Math.random());

                // Dimensions
                const w = gameArea.clientWidth;
                const h = gameArea.clientHeight;

                // Render Scattered Items
                pool.forEach(icon => {
                    if (counts[icon] !== undefined) {
                        counts[icon]++;
                    }

                    const el = document.createElement('div');
                    el.classList.add('scatter-item');
                    el.innerText = icon;

                    // Improved random distribution to avoid edges
                    const x = Math.random() * (w - 50); 
                    const y = Math.random() * (h - 50);
                    const size = sizeVar ? (1.2 + Math.random() * 1.5) + 'rem' : '2rem';
                    const rot = rotVar ? (Math.random() * 360) + 'deg' : '0deg';

                    el.style.left = x + 'px';
                    el.style.top = y + 'px';
                    el.style.fontSize = size;
                    el.style.transform = `rotate(${rot})`;
                    
                    gameArea.appendChild(el);
                });

                // Save State
                gameState = {
                    counts: counts,
                    targetIcons: targetIcons
                };
            }

            // RENDER QUEST GRID (Based on state)
            questGrid.innerHTML = '';
            gameState.targetIcons.forEach(icon => {
                const count = gameState.counts[icon];
                const displayContent = showSolution ? count : ''; // Show number or empty
                
                const qItem = document.createElement('div');
                qItem.classList.add('quest-item');
                qItem.innerHTML = `
                    <div class="q-icon">${icon}</div>
                    <div class="q-box">${displayContent}</div>
                `;
                questGrid.appendChild(qItem);
            });
        }

        window.onload = () => {
            updateColors();
            updateLanguage(); // This triggers renderText
            generate(true);
        };
    </script>
	<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
function saveAsImage() {
    const target = document.querySelector(".worksheet-wrapper");

    const isChrome = /Chrome/.test(navigator.userAgent) && !/Firefox/.test(navigator.userAgent);

    html2canvas(target, {
        scale: isChrome ? 1.5 : 2,
        useCORS: true,
        backgroundColor: "#ffffff"
    }).then(canvas => {
        const link = document.createElement("a");
        link.download = "spy-generator-worksheet.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
}
</script>

</body>
</html>